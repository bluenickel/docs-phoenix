<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Service Modules - Phoenix Docs</title>
  

  <link rel="shortcut icon" href="../../../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Service Modules";
    var mkdocs_page_input_path = "developer\modules\service-modules\get-started.md";
    var mkdocs_page_url = "/developer/modules/service-modules/get-started/";
  </script>
  
  <script src="../../../../js/jquery-2.1.1.min.js"></script>
  <script src="../../../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../../../js/highlight.pack.js"></script>
  <script src="../../../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../../.." class="icon icon-home"> Phoenix Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Developer</span></li>

        
            
    <ul class="subnav">
    <li><span>Modules</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../get-started/">Get Started</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../client-modules/get-started/">Client Modules</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Service Modules</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#get-started-with-phoenix-service-modules">Get Started with Phoenix Service Modules</a></li>
                
                    <li><a class="toctree-l4" href="#setting-up-a-new-web-application">Setting up a new web application</a></li>
                
                    <li><a class="toctree-l4" href="#adding-an-existing-module">Adding an existing module</a></li>
                
            
            </ul>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../tools/get-started/">Tools</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../..">Phoenix Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../..">Docs</a> &raquo;</li>
    
      
        
          <li>Developer &raquo;</li>
        
      
        
          <li>Modules &raquo;</li>
        
      
    
    <li>Service Modules</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="get-started-with-phoenix-service-modules">Get Started with Phoenix Service Modules</h1>
<p>The Phoenix platform provides a web application base for building modular web services on the ASP.Net framework. It brings together the following elements.</p>
<ul>
<li>ASP.Net Web API</li>
<li>ASP.Net Identity Framework</li>
<li>Dependency Injection using SimpleInjector</li>
</ul>
<h2 id="setting-up-a-new-web-application">Setting up a new web application</h2>
<p>To begin a new web application, create a new, empty ASP.Net Web API project and install the Phoenix Web package.</p>
<pre><code>PM&gt; Install-Package Phoenix.Web
</code></pre>

<p>Then add a new <code>Startup.cs</code> file with the following contents.</p>
<p>```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using Microsoft.Owin;
using Owin;
using Phoenix.Web;</p>
<p>[assembly: OwinStartup(typeof(MyWebApplication.Startup))]</p>
<p>namespace MyWebApplication
{
    public class Startup
    {</p>
<pre><code>    public void Configuration(IAppBuilder app)
    {
        app.UsePhoenix();
    }
}
</code></pre>
<p>}</p>
<pre><code>
That's all you have to do to get a modular web application running using the Phoenix platform.

## Add a new module
To create a new service module, add a new empty class library project to your solution.

It is recommended that you add a folder for `Controllers` and `Permissions` but you may put these classes where ever you like.

![Module Structure](resources/get-started-solution.png)

Add a class to define information about your module. For this example, we've added  the `MyModule` class which implements the `IPhoenixModule` interface. Implement the required members as follows.

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace MyModule
{
    public class MyModule : IPhoenixModule
    {
        public string Name
        {
            get
            {
                return &quot;My Module&quot;;
            }
        }

        public string Description
        {
            get
            {
                return &quot;My Module does some really great stuff.&quot;;
            }
        }

        /// &lt;summary&gt;
        /// Returns all permission groups for the module
        /// &lt;/summary&gt;
        public IEnumerable&lt;IPermissionGroup&gt; PermissionGroups
        {
            get
            {
                return new List&lt;IPermissionGroup&gt;()
                {
                    new Permissions.MyFeaturePermissions()
                };
            }
        }

        public MyModule(/*Use dependency injection to inject any dependencies here*/)
        {
            //Module initialisation code goes here.
        }

        public void Configure(params object[] args)
        {
            //You can configure the module here.
            //This is called when the web application starts.
        }
    }
}

</code></pre>

<p>You may have noticed the <code>PermissionGroups</code> member. We'll get to that in the next section. For now, you may simply add Web API controllers to the controllers folder and compile. Copy the compiled dll to the <code>bin/Modules</code> under the MyWebApplication project. The dll is loaded and everything is ready for you to start using the controllers in this module.</p>
<h3 id="configuring-module-permissions">Configuring module permissions</h3>
<p>You can configure module permissions for use with the <code>Phoenix.Security</code> package.</p>
<p>Install the <code>Phoenix.Security</code> package using the following command.</p>
<pre><code>PM&gt; Install-Package Phoenix.Security
</code></pre>

<p>Service modules, expose a list of <code>PermissionGroups</code>. A <code>PermissionGroup</code> is intended to define a set of permissions for a specific feature of your module. For example, if your module deals with products and you want to secure these you might define a permission group for products with the following permissions.</p>
<ul>
<li>Can View Product</li>
<li>Can Create Product</li>
<li>Can Edit Product</li>
<li>Can Delete Product</li>
</ul>
<p>This will allow you to control all CRUD related aspects of a product where only certain users can delete a product.</p>
<p>A permission group can be define as follows.</p>
<p>```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;</p>
<p>namespace MyModule.Permissions
{
    public class MyFeaturePermissions
    {
        public string Description
        {
            get
            {
                return "Controls access to process my feautre.";
            }
        }</p>
<pre><code>    public string Name
    {
        get
        {
            return "My Feature";
        }
    }

    public IEnumerable&lt;IPermission&gt; Permissions
    {
        get
        {
            return new List&lt;IPermission&gt;
            {
                new CanViewMyFeature(),
                new CanCreateMyFeature(),
                new CanDeleteMyFeature(),
                new CanEditMyFeature()
            };
        }
    }

    public class CanViewMyFeature : PermissionBase, IPermission
    {
        public string Name { get { return "View"; } }
        public string Description { get { return "Provides access to view My Feature"; } }
    }

    public class CanCreateMyFeature : PermissionBase, IPermission
    {
        public string Name { get { return "Create"; } }
        public string Description { get { return "Provides access to create new My Feature"; } }
    }

    public class CanDeleteMyFeature : PermissionBase, IPermission
    {
        public string Name { get { return "Delete"; } }
        public string Description { get { return "Provides access to delete My Feature"; } }
    }

    public class CanEditMyFeature : PermissionBase, IPermission
    {
        public string Name { get { return "Edit"; } }
        public string Description { get { return "Provides access to change My Feature"; } }
    }
}
</code></pre>
<p>}</p>
<pre><code>
To use permissions in a controller or anywhere throughout your code, you can use the `IPhoenixAccess` component can be acquired using dependency injection. The following code demonstrates this.

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Web.Http;
using Phoenix.Access;
using static MyModule.Permissions.MyFeaturePermissions;

namespace MyModule.Controllers
{
    public class MyFeatureController
    {
        IPhoenixAccess access;

        public MyFeatureController(IPhoenixAccess access /*Injected via DI*/)
        {
            this.access = access;
        }

        /// &lt;summary&gt;
        /// List all existing items of my feature
        /// &lt;/summary&gt;
        /// &lt;returns&gt;My features items&lt;/returns&gt;
        [HttpGet]
        [Route(&quot;&quot;)]
        public IEnumerable&lt;string&gt; ListItems()
        {
            access.CheckAccess&lt;CanViewMyFeature&gt;(RequestContext.Principal);

            return new[] { &quot;Item 1&quot;, &quot;Item 2&quot; };
        }
    }
}

</code></pre>

<p>If the current user (Principal) does not have access for this permission an exception will be thrown and the code will not continue to execute.</p>
<h2 id="adding-an-existing-module">Adding an existing module</h2>
<p>You can use NuGet to install a module from a NuGet feed.</p>
<p>Comming Soon!</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../../tools/get-started/" class="btn btn-neutral float-right" title="Tools">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../client-modules/get-started/" class="btn btn-neutral" title="Client Modules"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../client-modules/get-started/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../../tools/get-started/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
